<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="gov.alaska.dggs.igneous.Prospect">
	<select id="getList" resultSetType="FORWARD_ONLY" resultMap="ProspectMap">
		SELECT prospect_id, name, alt_names, ardf_number
		FROM prospect
		ORDER BY LOWER(name)
	</select>


	<select id="getByID" resultSetType="FORWARD_ONLY" parameterType="int" resultMap="ProspectMap">
		SELECT prospect_id, name, alt_names, ardf_number
		FROM prospect
		WHERE prospect_id = #{id}
	</select>


	<resultMap id="ProspectMap" type="Prospect">
		<id property="id" column="prospect_id" />
		<result property="name" column="name" />
		<result property="alt_names" column="alt_names" />
		<result property="ardf" column="ardf_number" />

		<collection property="files" column="prospect_id"
			ofType="File" select="gov.alaska.dggs.igneous.File.getByProspectID" />
	</resultMap>


	<select id="getGeoJSONByID" resultSetType="FORWARD_ONLY" parameterType="int" resultType="String">
		SELECT
			ST_AsGeoJSON(ST_Collect(geog::GEOMETRY)::GEOGRAPHY, 5, 0) AS geojson
		FROM (
			SELECT DISTINCT ON (ST_AsBinary(geog))
				geog
			FROM borehole AS bh
			JOIN borehole_geog AS bg
				ON bh.borehole_id = bg.borehole_id
			WHERE bh.prospect_id = #{prospect_id}
		) AS q
	</select>
</mapper>
