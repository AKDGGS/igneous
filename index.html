<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Alaska Geologic Materials Center</title>
		<link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
		<style>
			.input-fat { width: 400px; }
			#inventory_panel { display: none; }
		</style>
		<!--[if lt IE 9]>
		<script src="js/html5shiv.js"></script>
		<script src="js/respond.min.js"></script>
		<![endif]-->
	</head>
	<body>
		<div class="navbar navbar-default navbar-static-top">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#">Geologic Materials Center</a>
				</div>
				<div class="navbar-collapse collapse">
					<form class="navbar-form navbar-right">
						<div class="form-group">
							<input type="text" tabindex="1" placeholder="Search inventory" class="form-control input-fat" id="q">
							<button type="submit" class="btn btn-primary" id="search"><span class="glyphicon glyphicon-search"></span> Search</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<div class="container">
			<div class="panel panel-default" id="inventory_panel">
				<div class="panel-heading">Inventory</div>
				<div class="panel-body" id="inventory_header"></div>
				<table id="inventory_table" class="table">
					<thead>
						<tr>
							<th>ID</th>
							<th>Barcode</th>
							<th>Sample Number</th>
							<th>Branch</th>
							<th>Keywords</th>
							<th>Related</tH>
						</tr>
					</thead>
					<tbody id="inventory_body"></tbody>
				</table>
				<div class="panel-footer" id="inventory_footer"></div>
			</div>
		</div>

		<div class="modal" id="error_modal" role="dialog" aria-labelledby="Error" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title">Query Error</h4>
					</div>
					<div class="modal-body" id="error_body"></div>
					<div class="modal-footer">
						<button type="button" data-dismiss="modal" class="btn btn-primary">Okay</button>
					</div>
				</div>
			</div>
		</div>

		<script src="js/jquery-1.10.2.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script>
			$(function(){
				$('#search').click(function(){
					var q = $('#q').val();

					if(q.length > 0){
						$.ajax({
							url: 'inventory', dataType: 'json', data: { 'q': q },
							error: function(xhr){
								$('#error_body').text(xhr.responseText);
								$('#error_modal').modal({ show: true });
							},
							success: function(json){
								if(json.length == 0){
									$('#inventory_header').text(
										'No results have been found for your query. ' +
										'Please narrow the search parameters and try again.'
									);
									$('#inventory_header').show();
									$('#inventory_table').hide();
								} else {
									var body = document.getElementById('inventory_body');
									while(body.hasChildNodes()){
										body.removeChild(body.firstChild);
									}

									for(var i in json){
										var tr = document.createElement('tr');

										var td = document.createElement('td');
										var a = document.createElement('a');
										a.href = 'detail/' + json[i]['ID'];
										a.appendChild(document.createTextNode(
											json[i]['ID']
										));
										td.appendChild(a);
										tr.appendChild(td);

										td = document.createElement('td');
										if(json[i]['barcode'] !== null){
											td.appendChild(document.createTextNode(
												json[i]['barcode']
											));
										}
										tr.appendChild(td);

										td = document.createElement('td');
										if(json[i]['sampleNumber'] !== null){
											td.appendChild(document.createTextNode(
												json[i]['sampleNumber']
											));
										}
										tr.appendChild(td);

										td = document.createElement('td');
										td.appendChild(document.createTextNode(
											json[i]['branch']['name']
										));
										tr.appendChild(td);

										td = document.createElement('td');
										for(var j in json[i]['keywords']){
											var keyword = json[i]['keywords'][j];
											td.appendChild(document.createTextNode(
												(j > 0 ? ', ' : '') +
												keyword['name']
											));
										}
										tr.appendChild(td);

										td = document.createElement('td');
										for(var j in json[i]['boreholes']){
											var borehole = json[i]['boreholes'][j];

											var div = document.createElement('div');
											div.appendChild(document.createTextNode(
												'Borehole: '
											));

											a = document.createElement('a');
											a.href = '#';
											a.appendChild(document.createTextNode(
												borehole['name']
											));
											div.appendChild(a);

											td.appendChild(div);
										}
										tr.appendChild(td);

										body.appendChild(tr);
									}

									$('#inventory_table').show();
									$('#inventory_header').hide();
								}

								$('#inventory_panel').show();
							}
						});
					}
					return false;
				});
			});
		</script>
	</body>
</html>
